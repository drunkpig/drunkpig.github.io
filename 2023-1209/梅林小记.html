<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>梅林小记</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/code_hilighting.css" type="text/css" media="screen"
          charset="utf-8">
    <link rel="stylesheet" href="../css/simple.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="../css/pages.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="../css/mytheme.css" type="text/css" media="screen" charset="utf-8">

    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$']]
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?ccd0a4c5305cc998d59f5c06a24a2b93";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


</head>
<body>


<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="article_title">梅林小记</h1>
            <div class="tags_container">
                
            </div>
        </div>


    </div>
    <div class="row">
        <div class="post_content col-lg-10 col-md-10 col-xs-10 col-md-10">
            <h1 id="r8000">R8000路由器梅林小记</h1>
<h2 id="_1">问题</h2>
<p>我想用几个号之间互相看视频得奖励。首先要做好安全问题，就要做到：</p>
<ol>
<li>20个手机都要上网</li>
<li>手机与手机之间不能网络互通</li>
<li>每个手机都有一个独立的公网ip</li>
<li>成本足够低，复用一条家庭带宽</li>
</ol>
<h2 id="_2">解决办法</h2>
<h3 id="20">20个手机一起上网</h3>
<p>这个比较好办，土豪用流量卡，屌丝用OTG三合一线。
不知道OTG三合一是啥的看这里 <a href="https://detail.1688.com/offer/672826327296.html">https://detail.1688.com/offer/672826327296.html</a>
或者 <a href="https://item.taobao.com/item.htm?spm=a21n57.1.0.0.293b523c45hWyf&amp;id=668795725656&amp;ns=1&amp;abbucket=1#detail">https://item.taobao.com/item.htm?spm=a21n57.1.0.0.293b523c45hWyf&amp;id=668795725656&amp;ns=1&amp;abbucket=1#detail</a></p>
<p>USB供电有专门的多口USB供电，但是要注意一定要usb扩展而不是仅仅充电的,USB扩展可以通过USB控制传输数据，如果你只需要通过网络控制那可以忽略。
USB扩展配件可以参考这个：<a href="https://detail.tmall.com/item.htm?ali_refid=a3_420434_1006:1106460419:N:+5e3tIOIUlznRm9uzqVoNg==:f146ad95fc30402c3e0afd7717cfea6a&amp;ali_trackid=1_f146ad95fc30402c3e0afd7717cfea6a&amp;id=540858197451&amp;spm=a21n57.1.0.0&amp;sku_properties=148242406:21516">https://detail.tmall.com/item.htm?ali_refid=a3_420434_1006:1106460419:N:+5e3tIOIUlznRm9uzqVoNg==:f146ad95fc30402c3e0afd7717cfea6a&amp;ali_trackid=1_f146ad95fc30402c3e0afd7717cfea6a&amp;id=540858197451&amp;spm=a21n57.1.0.0&amp;sku_properties=148242406:21516</a></p>
<h3 id="_3">手机之间网络不互通</h3>
<p>这个需要用到软路由了。当手机连到同一个路由器，那么我需要在路由器的iptable上设置好手机用的网段的几个IP不能互访即可。</p>
<blockquote>
<p>路由器口不够可以下挂一个多口交换机。</p>
</blockquote>
<h2 id="ip">每个手机一个独立IP</h2>
<p>有好几个办法：</p>
<ol>
<li>ｉｐｖ６</li>
<li>在软路由上使用ｖ２ｒａｙ按照固定ｉｐ分流到不同的socks5或者任何其他例如shadowsocks</li>
<li>手机卡流量，路由器只组局域网进行控制用</li>
</ol>
<h2 id="_4">成本问题</h2>
<p>这个问题我是采用了服用家里的100M的电信宽带。细节忽略。</p>
<h3 id="_5">上面讲述的方案的拓扑图</h3>
<p>以上是理论上的，根据这个理论上的东西会玩的可以做很多改动。当然我自己会玩，我可以把我的方案放下面，成本绝对最低。硬件投入最少。</p>
<h2 id="_6">我的方案</h2>
<p>下图含3种方案，用到的硬件依次减少，但是对软件和网络理论的掌握要求越来越高。
<img alt="群控网络架构" src="我的群控网络方案.png" /></p>
<p>首先要说的是我的群控是一个机箱，所以插一根网线就能够所有手机上网了。</p>
<p>如果是个人没有这种专用机箱的情况下，可以用多口交换机扩展路由器的网口。</p>
<p>方案1中由于我家电信给的路由器R1接口太少，PC接上之后R2就没法接上，因此中间加入了一个交换机S，用于扩展路由器R1的接口，其他倒没有特别的用途。</p>
<p>方案2中就是把方案1的交换机去掉了，仅此而已，少了一些硬件和线材盘根错节。</p>
<p>方案3则更做了进一步精简，群控主机使用网线连到主机上，主机另外一个网口插到路由器上。此时我的pc上运行了一个虚拟机Linux，把这台Linux做成一个网关，让群控主机通过这个网关出去。
- dhcp在Linux上打开
- socks5+v2ray+redsocks 透明代理
- 网关
- 手机静态IP
- vm上隔离这个网段下的IP，禁止互通，这样可以减少风控的风险。</p>
<h2 id="_7">梅林配置记录</h2>
<h3 id="ap">作为主路由的扩展（AP模式或者叫无线访问点模式）</h3>
<p><img alt="" src="梅林无线访问点模式.png" /></p>
<p>这个模式需要把路由的WAN口连接到上一级路由器WAN口。其他不做设置即可。
这种模式下，连接到二级路由器上的设备得到的ip和直接连在一级路由器上的设备获得的ip是一个网段的。一级和二级路由上都能看到全部联网的设备。</p>
<h3 id="_8">作为独立子网（上图中的无线路由器模式）</h3>
<p>这种模式的特点是，连接到二级路由上的设备有完全独立的一个子网，和一级路由的设备不能互通。一级路由器只能看到二级路由IP，但是无法看到二级路由上连接的设备。</p>
<p>在这种模式下，需要比AP模式做更多的配置。</p>
<ul>
<li>二级路由WAN连到上级路由任何一个LAN口</li>
<li>二级路由的WAN口设置为静态IP，并且网关设置为一级路由地址（作为网关）</li>
<li>二级LAN口打开DHCP，设置一个和一级路由不同的网段</li>
</ul>
<p><img alt="" src="WAN口设置.png" />
<img alt="" src="LAN口设置.png" />
<img alt="" src="LAN口打开DHCP.png" />
<img alt="" src="ipv6配置.png" /></p>
<h2 id="_9">梅林的商店安装离线插件</h2>
<p>梅林有很多人在魔改，我用的是https://<a href="http://www.koolcenter.com/">www.koolcenter.com/</a> 这个站点魔改的，国内比较火，应该不会有问题。</p>
<h3 id="r8000_1">路由器r8000固件下载地址</h3>
<p>我的路由器是网件R8000，路由器固件不怎么更新了，毕竟几年前的机器，固件下载地如下：
<a href="https://fw.koolcenter.com/well-known-authors/KoolCenter_Merlin_Legacy_380/Netgear/">https://fw.koolcenter.com/well-known-authors/KoolCenter_Merlin_Legacy_380/Netgear/</a></p>
<p>上面连接还有其他一些型号的都可以找到。</p>
<h3 id="_10">刷回网件原始固件</h3>
<p>如果要刷回原固件可以在这里找到原始的网件R8000固件：<a href="https://fw.koolcenter.com/well-known-authors/KoolCenter_Merlin_Legacy_380/Netgear/R8000/Merlin%20to%20OFW/">https://fw.koolcenter.com/well-known-authors/KoolCenter_Merlin_Legacy_380/Netgear/R8000/Merlin%20to%20OFW/</a></p>
<h3 id="_11">安装插件之前配置</h3>
<p><code>第一步</code>
安装之前先打开一些配置项：
<img alt="" src="系统管理设置.png" /></p>
<p><code>第二步</code>
其次登录到ssh中修改一下配置，这样可以安装一些你懂的一些插件。配置看这里，很简短：<a href="https://zhuanlan.zhihu.com/p/402240863">https://zhuanlan.zhihu.com/p/402240863</a></p>
<p>核心就是ssh进路由器，执行这么一句</p>
<div class="codehilite"><pre><span></span><code>sed -i <span class="s1">&#39;s/\tdetect_package/\t# detect_package/g&#39;</span> /koolshare/scripts/ks_tar_install.sh
</code></pre></div>


<p><code>最后</code>
 来到 <a href="https://hq450.github.io/fancyss/">https://hq450.github.io/fancyss/</a> 下载对应的插件，我的R8000经过一番查找最后在 <a href="https://github.com/hq450/fancyss_history_package/blob/master/legacy/fancyss_arm380/shadowsocks_4.2.2.tar.gz">https://github.com/hq450/fancyss_history_package/blob/master/legacy/fancyss_arm380/shadowsocks_4.2.2.tar.gz</a> 下载到了。</p>
<p>然后进入软件中心上传，安装。</p>
<p><img alt="" src="软件中心-离线安装.png" />
<img alt="" src="科学上网安装成功.png" /></p>
<h2 id="_12">工具</h2>
<ul>
<li>ip检测API <a href="https://ip.sb/api/">https://ip.sb/api/</a></li>
<li>ipv6另一个api <a href="https://limit.888005.xyz/">https://limit.888005.xyz/</a></li>
</ul>

        </div>
        <div class="mytoc col-lg-2 col-md-2 col-xs-2 col-md-2">
            <span class="toc_title">目录</span>
            <div class="toc">
<ul>
<li><a href="#r8000">R8000路由器梅林小记</a><ul>
<li><a href="#_1">问题</a></li>
<li><a href="#_2">解决办法</a><ul>
<li><a href="#20">20个手机一起上网</a></li>
<li><a href="#_3">手机之间网络不互通</a></li>
</ul>
</li>
<li><a href="#ip">每个手机一个独立IP</a></li>
<li><a href="#_4">成本问题</a><ul>
<li><a href="#_5">上面讲述的方案的拓扑图</a></li>
</ul>
</li>
<li><a href="#_6">我的方案</a></li>
<li><a href="#_7">梅林配置记录</a><ul>
<li><a href="#ap">作为主路由的扩展（AP模式或者叫无线访问点模式）</a></li>
<li><a href="#_8">作为独立子网（上图中的无线路由器模式）</a></li>
</ul>
</li>
<li><a href="#_9">梅林的商店安装离线插件</a><ul>
<li><a href="#r8000_1">路由器r8000固件下载地址</a></li>
<li><a href="#_10">刷回网件原始固件</a></li>
<li><a href="#_11">安装插件之前配置</a></li>
</ul>
</li>
<li><a href="#_12">工具</a></li>
</ul>
</li>
</ul>
</div>

        </div>
    </div>
    <div class="row">
        <script src="https://utteranc.es/client.js"
        repo="drunkpig/drunkpig.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
        </script>
    </div>
</div>





<div class="container">
    <div class="row text-center">
	build:&nbsp;&nbsp; <a target='_blank' href='https://travis-ci.com/github/drunkpig/drunkpig.github.io'>__BUILD_VERSION__</a>
	
	</div>
</div>

</body>
</html>